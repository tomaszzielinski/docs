<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>

  <title>tomaszzielinski/docs @ GitHub</title>

  <style type="text/css">
    body {
      margin-top: 1.0em;
      background-color: #ffffff;
      font-family: Helvetica, Arial, FreeSans, san-serif;
      color: #000000;
    }
    #container {
      margin: 0 auto;
      width: 700px;
    }
    h1 { font-size: 3.8em; color: #000000; margin-bottom: 3px; }
    h1 .small { font-size: 0.4em; }
    h1 a { text-decoration: none }
    h2 { font-size: 1.5em; color: #000000; }
    h3 { text-align: center; color: #000000; }
    a { color: #000000; }
    pre a { color: white; }
    .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
    .download { float: right; }
    pre { background: #000; color: #fff; padding: 15px;}
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .footer { text-align:center; padding-top:30px; font-style: italic; }
  </style>
</head>

<body>
  <a href="https://github.com/tomaszzielinski/docs"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>

  <div id="container">

    <div class="download">
      <a href="https://github.com/tomaszzielinski/docs/zipball/master">
        <img border="0" width="90" src="https://github.com/images/modules/download/zip.png"></a>
      <a href="https://github.com/tomaszzielinski/docs/tarball/master">
        <img border="0" width="90" src="https://github.com/images/modules/download/tar.png"></a>
    </div>

    <h1><a href="https://github.com/tomaszzielinski/docs">Speeding up you Django website</a>
      <span class="small">by <a href="https://github.com/tomaszzielinski">tomaszzielinski</a></span></h1>

    <div class="description">
        <h1>Django best practices</h1>
        
        <h2>settings.py</h2>
                
        <ul>
            <li>Either have a global, versioned <em>settings.py</em> file which imports a local (non-versioned) configuration:
                <pre>
import settings_local 
                </pre>
                which has a versioned template <em>settings_local.py.template</em>, or use the reverse approach - have a common settings file, e.g. <em>common_settings.py</em>
                and then a non-versioned settings.py which import the common stuff. This seems to be the preferred way.
            </li>
            <li>
                <pre>PROJECT_ROOT = os.path.dirname(os.path.realpath(__file__))</pre> or
                <pre>PROJECT_ROOT = os.path.realpath(os.path.dirname(__file__))</pre> - both forms seems to be actively used, they are pretty much equivalent
            </li>
            <li>
                Then, to get full file paths, use <pre>os.path.join(PROJECT_ROOT, 'dir1', 'myfile.txt')</pre>
            </li>
            <li>
                <pre>TEMPLATE_DEBUG = True</li> You probably always want to have the detailed information about errors in templates. This is independent of DEBUG setting.
            </li>
            <li>
                You may want to use 
                <a href="http://www.codinghorror.com/blog/2008/08/protecting-your-cookies-httponly.html">HttpOnly</a> 
                <a href="http://stackoverflow.com/questions/3529695/how-do-i-set-httponly-cookie-in-django">cookies</a>:
                <pre>SESSION_COOKIE_PATH = '/; HttpOnly'</pre>
                <pre>SESSION_COOKIE_HTTPONLY = True (In Django 1.3+?)</pre>
            </li>
            <li>
                For multilingual sites:
                <pre>USE_I18N = True</pre>
                Possibly you want:
                <pre>USE_L10N = True</pre>
                Language definitions:
                <pre>
gettext = lambda s: s
LANGUAGES = (
    ('sv', gettext('Swedish')),
    ('en', gettext('English')),
)
</pre>
            </li>
            <li>
                If you use a global (per-project) template folder:
                <pre>TEMPLATE_DIRS = (os.path.join(PROJECT_ROOT, 'templates'),)</pre>
            </li>
            
        </ul>

        <h2>(De facto) standard add-ons</h2>
        
        <ul>
            <li><a href="http://south.aeracode.org/">South migrations</a> - you might want to use the following settings:
<pre>
<a href="http://south.aeracode.org/docs/settings.html#skip-south-tests">SKIP_SOUTH_TESTS</a> = True
<a href="http://south.aeracode.org/docs/settings.html#south-tests-migrate">SOUTH_TESTS_MIGRATE</a> = False
</pre>                
            </li>
            <li>
               <a href="http://pypi.python.org/pypi/django-debug-toolbar/0.8.4">Django Debug Toolbar</a> - make sure to configure it according to <a href="http://pypi.python.org/pypi/django-debug-toolbar/0.8.4#installation">docs</a>
            </li>
            <li>
               <a href="https://github.com/dcramer/django-sentry">Django Sentry</a> - the preferred way to catch exceptions and log messages.
               It has been split into Sentry and <a href="https://github.com/dcramer/raven">Raven</a> so both are needed.
               Note that because Sentry/Raven are meant to replace the default Django mechanism and also integrate deeply into the framework,
               some attention is needed during <a href="http://raven.readthedocs.org/en/latest/config/django.html">configuration</a>.
               Also note that there were unsolved (are?) problems like <a href="https://github.com/dcramer/django-sentry/issues/210">this one</a>.
               But still Sentry/Raven is the best such tool out there.
        </ul>

        <h2>MySQL 5.x</h2>
        
        <ul>
            <li>Create the database using the following command:
                <pre>CREATE DATABASE CHARACTER SET UTF8;</pre>
            </li>
            <li>
                To convert an existing table with different encoding, use:
                <pre>ALTER TABLE tab CONVERT TO CHARACTER SET utf8 COLLATE utf8_unicode_ci;</pre>
                Note that <strong>CONVERT TO</strong> is critical to do the actual encoding conversion.
            </li>
            <li>
                Make sure you tables use the InnoDB engine. 
                You can make sure that it is so by adding this line to your database configuration:
                <pre>'OPTIONS': {'init_command': 'SET storage_engine=INNODB',}</pre>
                <a href="https://docs.djangoproject.com/en/1.3/ref/databases/#creating-your-tables">[more]</a>
            </li>
            <li>
                You can make the InnoDB engine the default one in my.cnf file, 
                and you don't even have to modify the global my.cnf but use a <a href="https://docs.djangoproject.com/en/1.3/ref/databases/#connecting-to-the-database">custom config file</a> for you Django project.
            </li>
            <li>
            </li>
        </ul>

        <h2>Forms</h2>
        
        <ul>
            <li>
                Smart handling of forms in views (Credits go to <a href="http://speakerdeck.com/u/pydanny/p/advanced-django-forms-usage">PyDanny&Co</a>).
                Instead of this:
                <pre>
def my_view(request):                 
    if request.method == 'POST':
        form = MyForm(request.POST)
        if form.is_valid():
            form.hooray()
            return HttpResponseRedirect('/success/')
    else:
        form = MyForm()
    return render_to_response('my_template.html', {'form': form})
                </pre>
                Do this:
                <pre>
def my_view(request):                     
    form = MyForm(request.POST or None)
    if form.is_valid():
        form.hooray()
        return HttpResponseRedirect('/success/')
    return render_to_response('my_template.html', {'form': form})
                </pre>
                The catch here is that <em>form.is_valid()</em> returns <em>False</em> for unbound forms.
            </li>
        </ul>
        
        <h2>HTTP and REST</h2>
        
        <ul>
            <li>
                A good practice is to design your URL structure so that it more or less follows 
                <a href="http://en.wikipedia.org/wiki/Representational_State_Transfer#RESTful_web_services">the defacto standard convention</a>.
                Note that this is mostly about "ordnung", not about being RESTful. It's very hard, if not impossible,
                to write a RESTful website - and if you violate any of the REST principles, you're not RESTful anymore.
                So just accept that and follow whatever is reasonable.
            </li>
            <li>
                Still not conviced that REST is not what it appears to be (i.e. a way of naming URLs)? Check these resources (in random order):
                <a href="http://stackoverflow.com/questions/973796/what-are-the-best-uses-of-rest-services">S.O. thread #1</a>,
                <a href="http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven">Roy Fielding's acrticle</a>,
                <a href="http://stackoverflow.com/questions/2001773/understanding-rest-verbs-error-codes-and-authentication">S.O. thread #2</a>,
                <a href="http://www.peej.co.uk/articles/restfully-delicious.html">Example of RESTful web service design</a>.
            </li>
            <li>
                Specifically, Django session are not RESTful. Check this:
                <a href="http://www.peej.co.uk/articles/no-sessions.html">1</a>,
                <a href="http://tech.groups.yahoo.com/group/rest-discuss/message/3583">2</a>,
                <a href="http://davidvancouvering.blogspot.com/2007/09/session-state-is-evil.html">3</a>
            </li>
            <li>
                Which HTTP error codes to use? <a href="http://www.aisee.com/graph_of_the_month/http.png">Here's the answer</a>.
                Ok ok, I know :-)
            </li>
            <li>
                But seriously, there are some rules that are worth following.
            </li>
            <li>
                <strong>HttpResponseBadRequest [400]</strong> seems to be a good choice when Django view is reached but request parameters are invalid.
                Here are some <a href="http://stackoverflow.com/questions/5077871/what-is-the-proper-http-response-code-for-request-without-mandatory-fields">good</a> <a href="http://stackoverflow.com/questions/4781187/http-400-bad-request-for-logical-error-not-malformed-request-syntax">discussions</a> 
                <a href="http://stackoverflow.com/questions/1364527/http-status-code-for-bad-data">on</a> this</a>.
            </li>
            <li>
                <strong>HttpResponseForbidden [403]</strong> looks like a good choice to indicate that authentication is needed
                in a situation when redirect to the login page doesn't make sense - e.g. for AJAX requests.
                Note that there is also 401 code, but it is meant to be used for the purposes of <a href="http://en.wikipedia.org/wiki/Basic_access_authentication">HTTP authentication</a>,
                and not a custom one. (<a href="http://stackoverflow.com/questions/6113014/what-http-code-to-use-in-not-authenticated-and-not-authorized-cases">A nice discussion</a> on this)
            </li>
        </ul>

        <h2>Misc</h2>
        
        <ul>
            <li>
                When replacing models.py into models package, make sure that models there have app_label set in their Meta:
                <pre>
class Meta:
    app_label = 'app-name'
                </pre>
                Without this trick, Django won't see the models.
            </li>
        </ul>

    </div>

    
    

    

    

    

    
      <h2>Contact</h2>
      <p> (tomasz.zielinski@pyconsultant.eu)
<br/>      </p>
    

    <h2>Download</h2>
    <p>
      You can download this project in either
      <a href="https://github.com/tomaszzielinski/docs/zipball/master">zip</a> or
      <a href="https://github.com/tomaszzielinski/docs/tarball/master">tar formats.
    </p>
    <p>You can also clone the project with <a href="http://git-scm.com">Git</a>
      by running:
      <pre>$ git clone git://github.com/tomaszzielinski/docs</pre>
    </p>

    <div class="footer">
      get the source code on GitHub : <a href="https://github.com/tomaszzielinski/docs">tomaszzielinski/docs</a>
    </div>

  </div>

</body>
</html>
